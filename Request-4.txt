4.  Follow-up: Which segment had the most increase in unique products in 
2021 vs 2020?

WITH product_2020 AS (
    SELECT p.segment,
        COUNT(DISTINCT f.product_code) AS product_count_2020
    FROM fact_sales_monthly f
    JOIN dim_product p ON f.product_code = p.product_code
    WHERE f.fiscal_year = 2020
    GROUP BY p.segment),
product_2021 AS (
    SELECT p.segment,
        COUNT(DISTINCT f.product_code) AS product_count_2021
    FROM fact_sales_monthly f
    JOIN dim_product p ON f.product_code = p.product_code
    WHERE f.fiscal_year = 2021
    GROUP BY p.segment)
SELECT p21.segment,
    COALESCE(p20.product_count_2020, 0) AS product_count_2020,
    p21.product_count_2021,
    (p21.product_count_2021 - COALESCE(p20.product_count_2020, 0)) AS difference
FROM product_2021 p21
LEFT JOIN product_2020 p20 ON p21.segment = p20.segment
ORDER BY difference DESC;